# node-npm-Hardhat3-ä¼˜åŒ–ç‰ˆå…¨æµç¨‹å®‰è£…éƒ¨ç½²æŒ‡å—-V2
**â€”â€” ä»é›¶åˆ°éƒ¨ç½²çš„å®Œæ•´å®è·µ | ç¯å¢ƒé…ç½® Â· é¡¹ç›®ç»“æ„ Â· å‘½ä»¤æ‰‹å†Œ Â· éªŒè¯é—­ç¯**
---
**æ›´æ–°æ—¶é—´ï¼š2025å¹´10æœˆ8æ—¥**
---

## ğŸ“š ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡ä¸ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ](#1-ç¯å¢ƒå‡†å¤‡ä¸ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ)  
2. [æ–°å»ºå¹¶åˆå§‹åŒ–é¡¹ç›®ï¼ˆäº¤äº’å¼æµç¨‹è¯¦è§£ï¼‰](#2-æ–°å»ºå¹¶åˆå§‹åŒ–é¡¹ç›®äº¤äº’å¼æµç¨‹è¯¦è§£)  
3. [ä¾èµ–å®‰è£…è¿‡ç¨‹æ·±åº¦è§£æ](#3-ä¾èµ–å®‰è£…è¿‡ç¨‹æ·±åº¦è§£æ)  
4. [é¡¹ç›®ç»“æ„å…¨è§£æ](#4-é¡¹ç›®ç»“æ„å…¨è§£æ)  
5. [éªŒè¯ç¯å¢ƒä¸ç¼–è¯‘åˆçº¦](#5-éªŒè¯ç¯å¢ƒä¸ç¼–è¯‘åˆçº¦)  
6. [å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ä¸äº¤äº’æ§åˆ¶å°](#6-å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ä¸äº¤äº’æ§åˆ¶å°)  
7. [ä½¿ç”¨ Ignition éƒ¨ç½²åˆçº¦ï¼ˆä¿®æ­£ç‰ˆï¼‰](#7-ä½¿ç”¨-ignition-éƒ¨ç½²åˆçº¦ä¿®æ­£ç‰ˆ)  
8. [è¿è¡Œæµ‹è¯•ï¼šTypeScript + Solidity](#8-è¿è¡Œæµ‹è¯•typescript--solidity)  
9. [ä½¿ç”¨ Viem è¿›è¡Œé“¾ä¸ŠçŠ¶æ€æŸ¥è¯¢ä¸äº¤äº’](#9-ä½¿ç”¨-viem-è¿›è¡Œé“¾ä¸ŠçŠ¶æ€æŸ¥è¯¢ä¸äº¤äº’)  
10. [éƒ¨ç½²åéªŒè¯ä¸å¸¸ç”¨æ“ä½œ](#10-éƒ¨ç½²åéªŒè¯ä¸å¸¸ç”¨æ“ä½œ)  
11. [é™„å½•ï¼šHardhat å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨](#11-é™„å½•-hardhat-å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨)  
12. [æ€»ç»“ä¸æœ€ä½³å®è·µå»ºè®®](#12-æ€»ç»“ä¸æœ€ä½³å®è·µå»ºè®®)

---

## 1. ç¯å¢ƒå‡†å¤‡ä¸ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ

åœ¨å¼€å§‹æ„å»ºä»¥å¤ªåŠæ™ºèƒ½åˆçº¦é¡¹ç›®å‰ï¼Œç¡®ä¿æ‚¨çš„å¼€å‘ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹**ç¨³å®šã€å…¼å®¹ã€é¢å‘æœªæ¥**çš„æŠ€æœ¯æ ˆè¦æ±‚ã€‚æœ¬æŒ‡å—åŸºäº **Hardhat v3** çš„æœ€æ–° Beta ç‰ˆæœ¬è®¾è®¡ï¼Œé€‚ç”¨äºæ‰€æœ‰æ–°é¡¹ç›®ã€‚

### âœ… æ¨èæŠ€æœ¯æ ˆï¼ˆç»å®æµ‹éªŒè¯ï¼‰

| ç»„ä»¶ | ç‰ˆæœ¬ | æ˜¯å¦æœ€æ–° | ç¨³å®šæ€§ | æ”¯æŒæƒ…å†µ | è¯´æ˜ |
|------|------|----------|--------|------------|----------------|
| **Node.js** | `v22.18.0` | âœ… æ˜¯ | âœ… ç¨³å®š | å®Œå…¨æ”¯æŒ | æ¨èä½¿ç”¨ LTS ç‰ˆæœ¬ï¼›v22 å¯¹ ES æ¨¡å—å’Œæ€§èƒ½ä¼˜åŒ–æ›´ä½³ |
| **npm** | `10.9.3` | âœ… æ˜¯ | âœ… ç¨³å®š | å®Œå…¨æ”¯æŒ | ä¸ Node.js v22 æ†ç»‘å‘å¸ƒï¼Œæ— éœ€é¢å¤–å‡çº§ |
| **Hardhat** | `v3.0.6 (Beta)` | âš ï¸ Beta | âœ… æ¨èç”¨äºæ–°é¡¹ç›® | æ ¸å¿ƒæ¡†æ¶ | æ–°ä¸€ä»£é»˜è®¤é€‰æ‹©ï¼Œé›†æˆ Ignitionã€Viemã€Node Test Runner |
| **TypeScript** | `5.8.0` | âœ… æ˜¯ | âœ… ç¨³å®š | å®Œå…¨æ”¯æŒ | æ”¯æŒç°ä»£ç±»å‹ç³»ç»Ÿä¸è£…é¥°å™¨å®éªŒç‰¹æ€§ |
| **Viem** | `2.30.0` | âœ… æ˜¯ | âœ… ç¨³å®š | å®˜æ–¹æ¨èæ›¿ä»£ Ethers.js | è½»é‡ã€TypeScript ä¼˜å…ˆçš„ Ethereum SDK |
| **EVM Compiler (solc)** | `0.8.28` | âœ… æ˜¯ | âœ… ç¨³å®š | é»˜è®¤å†…ç½® | æ”¯æŒ Cancun å‡çº§ç›®æ ‡ï¼ˆEVM 1.0.0ï¼‰ |
| **@types/node** | `22.8.5` | âœ… æ˜¯ | âœ… ç¨³å®š | å¿…éœ€ä¾èµ– | åŒ¹é… Node.js v22 çš„ç±»å‹å®šä¹‰ |
| **forge-std** | `v1.9.4` | âœ… æ˜¯ | âœ… ç¨³å®š | å¯é€‰ä½†æ¨è | Foundry å›¢é˜Ÿç»´æŠ¤çš„æ ‡å‡†åº“ï¼Œç”¨äº Solidity æµ‹è¯• |
| **hardhat-toolbox-viem** | `5.0.0` | âœ… æ˜¯ | âœ… ç¨³å®š | Hardhat v3 å®˜æ–¹å·¥å…·ç®± | æ›¿ä»£æ—§ç‰ˆ `hardhat-toolbox`ï¼Œä¸“ä¸º Viem è®¾è®¡ |
| **hardhat-ignition** | `3.0.0` | âœ… æ˜¯ | âœ… ç¨³å®š | å†…ç½®éƒ¨ç½²æ¨¡å— | å£°æ˜å¼éƒ¨ç½²ç³»ç»Ÿï¼Œæ”¯æŒå¤æ‚ä¾èµ–æ‹“æ‰‘ |

> ğŸ” **ç‰ˆæœ¬è¯´æ˜**ï¼š
> - **Hardhat v3** æ˜¯é‡å¤§é‡æ„ç‰ˆæœ¬ï¼Œå¼•å…¥äº† `Ignition` éƒ¨ç½²å¼•æ“ å’Œ `Node Test Runner`ï¼Œä¸å†å¼ºåˆ¶ä¾èµ– Mochaã€‚
> - ä½¿ç”¨ `Viem` è€Œé `Ethers.js` æˆä¸ºå®˜æ–¹æ¨èè·¯å¾„ï¼Œå¸¦æ¥æ›´å¿«çš„æµ‹è¯•é€Ÿåº¦å’Œæ›´å¥½çš„ TS æ”¯æŒã€‚
> - æ‰€æœ‰ä¾èµ–å‡é€šè¿‡ `npm install` è‡ªåŠ¨è§£æï¼Œç‰ˆæœ¬é”å®šåœ¨ `package-lock.json` ä¸­ã€‚

### ğŸ§ª éªŒè¯ç¯å¢ƒå‘½ä»¤

è¯·åœ¨ç»ˆç«¯ä¸­é€ä¸€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç¡®è®¤è¾“å‡ºä¸æ¨èç‰ˆæœ¬ä¸€è‡´ï¼š

```bash
node -v   # é¢„æœŸè¾“å‡º: v22.18.0
npm -v    # é¢„æœŸè¾“å‡º: 10.9.3
```

âœ… è‹¥è¾“å‡ºåŒ¹é…ä¸Šè¡¨ï¼Œåˆ™ç¯å¢ƒå‡†å¤‡å°±ç»ªã€‚

---

## 2. æ–°å»ºå¹¶åˆå§‹åŒ–é¡¹ç›®ï¼ˆäº¤äº’å¼æµç¨‹è¯¦è§£ï¼‰

### æ³¨æ„ï¼šè‹¥å­˜åœ¨â€œç¼“å­˜æ±¡æŸ“â€é—®é¢˜ï¼Œé€šè¿‡â€œå¸è½½é‡è£…å‘½ä»¤â€è§£å†³
```bash
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•å¹¶è¿›å…¥

```bash
mkdir my-hardhat3-project && cd my-hardhat3-project
```

> ğŸ’¡ ç¡®ä¿å½“å‰ç›®å½•ä¸ºç©ºã€‚

---

### æ­¥éª¤ 2ï¼šå¯åŠ¨ Hardhat åˆå§‹åŒ–å‘å¯¼

```bash
npx hardhat --init
```

> ğŸ’¡ æ­¤å‘½ä»¤å°†å¼•å¯¼ä½ å®Œæˆäº¤äº’å¼é¡¹ç›®åˆ›å»ºæµç¨‹ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£… hardhatã€‚

---

### æ­¥éª¤ 3ï¼šé€‰æ‹© Hardhat ç‰ˆæœ¬

```
? Which version of Hardhat would you like to use?
  > Hardhat 3 Beta (recommended for new projects)
    Hardhat 2 (older version)
```

ğŸ‘‰ **é€‰æ‹©**ï¼š`Hardhat 3 Beta`

ğŸ“Œ **ç†ç”±**ï¼š
- ä½¿ç”¨æœ€æ–°çš„å£°æ˜å¼éƒ¨ç½²ç³»ç»Ÿ Ignition
- åŸç”Ÿæ”¯æŒ Viem å’Œ Node.js å†…ç½®æµ‹è¯•è¿è¡Œå™¨
- æ›´å¿«çš„ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²é€Ÿåº¦
- æ›´æ¸…æ™°çš„é”™è¯¯æç¤ºå’Œè°ƒè¯•ä½“éªŒ

---

### æ­¥éª¤ 4ï¼šæŒ‡å®šé¡¹ç›®è·¯å¾„

```
? Where would you like to initialize the project?
Please provide either a relative or an absolute path:
```

ğŸ‘‰ è¾“å…¥ï¼š`.` ï¼ˆè¡¨ç¤ºå½“å‰ç›®å½•ï¼‰

ğŸ“Œ **æç¤º**ï¼šè¯·ç¡®ä¿å½“å‰ä¸ºç©ºç›®å½•æˆ–å·²å¤‡ä»½é‡è¦æ–‡ä»¶ã€‚

---

### æ­¥éª¤ 5ï¼šé€‰æ‹©é¡¹ç›®æ¨¡æ¿

```
? What type of project would you like to initialize?
  > A TypeScript Hardhat project using Node Test Runner and Viem
    A TypeScript Hardhat project using Mocha and Ethers.js
```

ğŸ‘‰ **é€‰æ‹©**ï¼šç¬¬ä¸€ä¸ªé€‰é¡¹ï¼ˆNode Test Runner + Viemï¼‰

ğŸ“Œ **ä¼˜åŠ¿**ï¼š
- æ›´å¿«çš„æµ‹è¯•æ‰§è¡Œé€Ÿåº¦ï¼ˆNode.js åŸç”Ÿ `node:test`ï¼‰
- æ›´ç®€æ´çš„å¼‚æ­¥è¯­æ³•ï¼ˆ`async/await`ï¼‰
- æ›´å¼ºçš„ TypeScript ç±»å‹æ¨æ–­
- å®˜æ–¹æœªæ¥ä¸»æ¨æ–¹å‘

---

### æ­¥éª¤ 6ï¼šç¡®è®¤è‡ªåŠ¨å®‰è£…ä¾èµ–

ç³»ç»Ÿç”Ÿæˆå¦‚ä¸‹å®‰è£…å‘½ä»¤ï¼š

```bash
npm install --save-dev \
  "hardhat@3.0.6" \
  "@nomicfoundation/hardhat-toolbox-viem@5.0.0" \
  "@nomicfoundation/hardhat-ignition@3.0.0" \
  "@types/node@22.8.5" \
  "forge-std@foundry-rs/forge-std#v1.9.4" \
  "typescript@5.8.0" \
  "viem@2.30.0"
```

éšåæç¤ºï¼š

```
Do you want to run it now? (Y/n)
```

ğŸ‘‰ è¾“å…¥ï¼š`Y` æˆ–ç›´æ¥å›è½¦

ğŸ“Œ **ç»“æœ**ï¼šnpm å¼€å§‹ä¸‹è½½å¹¶å®‰è£…æ‰€æœ‰å¿…éœ€ä¾èµ–åŒ…ã€‚

---

## 3. ä¾èµ–å®‰è£…è¿‡ç¨‹æ·±åº¦è§£æ

å½“ç”¨æˆ·ç¡®è®¤åï¼Œnpm å°†æ‰§è¡Œä¾èµ–å®‰è£…æµç¨‹ã€‚

### ğŸ“¦ å®‰è£…æ—¥å¿—å…³é”®ä¿¡æ¯

```
added 171 packages in 2m
53 packages are looking for funding
  run `npm fund` for details
âœ… Dependencies installed âœ¨
ğŸŒŸ We â¤ï¸ open source â€“ if you found this useful, please give us a star on GitHub!
```

### ğŸ”§ æ ¸å¿ƒä¾èµ–åŠŸèƒ½è¯´æ˜

| åŒ…å | åŠŸèƒ½æè¿° |
|------|----------|
| `hardhat@3.0.6` | ä¸»æ¡†æ¶ï¼Œæä¾›ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€æ§åˆ¶å°ç­‰æ ¸å¿ƒèƒ½åŠ› |
| `@nomicfoundation/hardhat-toolbox-viem` | é›†æˆæ’ä»¶é›†åˆï¼šChai/Viem/Ignition/TypeChain ç­‰ |
| `@nomicfoundation/hardhat-ignition` | å£°æ˜å¼éƒ¨ç½²ç³»ç»Ÿï¼Œæ”¯æŒæ•…éšœæ¢å¤ã€çŠ¶æ€è¿½è¸ª |
| `viem@2.30.0` | ç°ä»£åŒ– Ethereum å®¢æˆ·ç«¯åº“ï¼Œè½»é‡é«˜æ•ˆï¼ŒTypeScript å‹å¥½ |
| `typescript@5.8.0` | ç¼–è¯‘ `.ts` æ–‡ä»¶ï¼Œæ”¯æŒé«˜çº§ç±»å‹æ£€æŸ¥ |
| `@types/node@22.8.5` | æä¾› Node.js API çš„ç±»å‹å®šä¹‰ |
| `forge-std` | å¼•å…¥ `stdError.sol`, `console2.sol` ç­‰è°ƒè¯•è¾…åŠ©åˆçº¦ |

> âš ï¸ æ³¨æ„ï¼š`forge-std` ä» GitHub å®‰è£…ï¼ˆé npmï¼‰ï¼Œéœ€ç½‘ç»œé€šç•…ã€‚

---

## 4. é¡¹ç›®ç»“æ„å…¨è§£æ

åˆå§‹åŒ–å®Œæˆåï¼Œé¡¹ç›®æ ¹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
my-hardhat3-project/
â”œâ”€â”€ contracts/               # Solidity åˆçº¦æºç 
â”‚   â”œâ”€â”€ Counter.sol          # ç¤ºä¾‹ä¸»åˆçº¦
â”‚   â””â”€â”€ Counter.t.sol        # Solidity æµ‹è¯•åˆçº¦ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ ignition/                # Ignition éƒ¨ç½²æ¨¡å—
â”‚   â””â”€â”€ modules/
â”‚       â””â”€â”€ Counter.ts       # å®šä¹‰å¦‚ä½•éƒ¨ç½² Counter åˆçº¦
â”œâ”€â”€ node_modules/            # ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ scripts/                 # è‡ªå®šä¹‰è„šæœ¬
â”‚   â””â”€â”€ send-op.ts           # ç¤ºä¾‹è„šæœ¬ï¼šå‘é€äº¤æ˜“è‡³ OP é“¾
â”œâ”€â”€ test/                    # TypeScript æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ Counter.ts           # ä½¿ç”¨ Viem ç¼–å†™çš„é›†æˆæµ‹è¯•
â”œâ”€â”€ artifacts/               # ç¼–è¯‘äº§ç‰©ï¼ˆé¦–æ¬¡ç¼–è¯‘åç”Ÿæˆï¼‰
â”œâ”€â”€ cache/                   # Hardhat ç¼“å­˜ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ .gitignore               # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ hardhat.config.ts        # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json             # é¡¹ç›®å…ƒæ•°æ®ä¸è„šæœ¬å®šä¹‰
â”œâ”€â”€ package-lock.json        # é”å®šä¾èµ–ç‰ˆæœ¬
â”œâ”€â”€ README.md                # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ tsconfig.json            # TypeScript ç¼–è¯‘é…ç½®
```

### ğŸ“ å…³é”®æ–‡ä»¶è¯´æ˜

| è·¯å¾„ | ç±»å‹ | åŠŸèƒ½è¯´æ˜ |
|------|------|----------|
| `contracts/*.sol` | Solidity | å­˜æ”¾æ‰€æœ‰æ™ºèƒ½åˆçº¦ä»£ç  |
| `contracts/*.t.sol` | Solidity | å¯ç”¨äºç¼–å†™åŸºäº Foundry é£æ ¼çš„ Solidity å•å…ƒæµ‹è¯• |
| `ignition/modules/*.ts` | TypeScript | å®šä¹‰åˆçº¦éƒ¨ç½²è®¡åˆ’ï¼Œæ”¯æŒå‚æ•°åŒ–ã€æ¡ä»¶éƒ¨ç½² |
| `scripts/*.ts` | TypeScript | è‡ªå®šä¹‰è„šæœ¬ï¼Œå¯ç”¨äºéƒ¨ç½²ã€è°ƒç”¨ã€æ‰¹é‡æ“ä½œ |
| `test/*.ts` | TypeScript | ä½¿ç”¨ Node.js åŸç”Ÿ `node:test` è¿è¡Œå™¨ç¼–å†™æµ‹è¯• |
| `hardhat.config.ts` | Config | é…ç½®ç½‘ç»œã€ç¼–è¯‘å™¨ã€æ’ä»¶ã€è´¦æˆ·ç­‰å…¨å±€è®¾ç½® |
| `tsconfig.json` | Config | æ§åˆ¶ TypeScript ç¼–è¯‘è¡Œä¸ºï¼ˆå¦‚ targetã€moduleã€strictï¼‰ |
| `.gitignore` | Text | å¿½ç•¥ `node_modules`, `artifacts`, `cache` ç­‰éå¿…è¦æäº¤å†…å®¹ |
| `package.json` | JSON | å®šä¹‰ `scripts` å¦‚ `"compile": "npx hardhat compile"` |

> ğŸŒŸ **æ–°å¢ç‰¹æ€§ï¼ˆHardhat v3ï¼‰**ï¼š
> - `artifacts/` å’Œ `cache/` åœ¨é¦–æ¬¡ç¼–è¯‘åè‡ªåŠ¨ç”Ÿæˆã€‚
> - æ”¯æŒ `.t.sol` æ–‡ä»¶ä½œä¸º Solidity æµ‹è¯•ç”¨ä¾‹ã€‚
> - `ignition/` ç›®å½•æ˜¯ **å£°æ˜å¼éƒ¨ç½²** çš„æ ¸å¿ƒï¼Œé¿å…ä¼ ç»Ÿè„šæœ¬ä¸­çš„â€œé¢æ¡ä»£ç â€ã€‚

---

## 5. éªŒè¯ç¯å¢ƒä¸ç¼–è¯‘åˆçº¦

### âœ… éªŒè¯ Hardhat å®‰è£…æˆåŠŸ

```bash
npx hardhat
```

é¢„æœŸè¾“å‡ºåº”åŒ…å«ç±»ä¼¼å†…å®¹ï¼š

```
Hardhat version 3.0.6

Usage: hardhat [GLOBAL OPTIONS] <TASK> [SUBTASK] ...

AVAILABLE TASKS:

  build         Build project
  clean         Clear the cache and delete all artifacts
  compile       Compile Solidity contracts
  console       Open a REPL on a local network
  node          Start a local Ethereum JSON-RPC node
  run           Run a user-defined script
  test          Run tests
  ...
```

ğŸ“Œ å‡ºç°ä»»åŠ¡åˆ—è¡¨å³è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚

---

### ğŸ”¬ ç¼–è¯‘åˆçº¦

```bash
npx hardhat compile
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
Compiling your Solidity contracts...
Compiled 1 Solidity file with solc 0.8.28 (evm target: cancun)
```

âœ… æˆåŠŸæ ‡å¿—ï¼š
- æ— è¯­æ³•é”™è¯¯
- è¾“å‡ºç¼–è¯‘å™¨ç‰ˆæœ¬ä¸ EVM ç›®æ ‡
- åœ¨ `artifacts/` ä¸‹ç”Ÿæˆ ABI ä¸ bytecode

> ğŸ’¡ é¦–æ¬¡ç¼–è¯‘åï¼Œ`artifacts/` å’Œ `cache/` ç›®å½•å°†è¢«åˆ›å»ºã€‚

---

## 6. å¯åŠ¨æœ¬åœ°èŠ‚ç‚¹ä¸äº¤äº’æ§åˆ¶å°

### ğŸ–¥ï¸ å¯åŠ¨æœ¬åœ°å¼€å‘èŠ‚ç‚¹

åœ¨**æ–°ç»ˆç«¯çª—å£**ä¸­è¿è¡Œï¼š

```bash
npx hardhat node
```

ğŸ“Œ è¾“å‡ºç¤ºä¾‹ï¼š

```
Started HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/

Accounts:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (0) 0xf39fd...fffb92266 (10000 ETH)                            â”‚                              â”‚
â”‚ Private Key: 0xac097...ff80                                   â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ è¯¥å‘½ä»¤å¯åŠ¨ä¸€ä¸ªå®Œæ•´çš„æœ¬åœ°ä»¥å¤ªåŠç½‘ç»œï¼ˆHardhat Networkï¼‰ï¼Œå¯ç”¨äºæµ‹è¯•å’Œè°ƒè¯•ã€‚

---

### ğŸ› ï¸ æ‰“å¼€äº¤äº’å¼æ§åˆ¶å°

åœ¨**å¦ä¸€ä¸ªç»ˆç«¯çª—å£**ä¸­è¿è¡Œï¼š

```bash
npx hardhat console --network localhost
```

> ğŸ’¡ æ­¤å‘½ä»¤è¿æ¥åˆ° `localhost:8545` ä¸Šè¿è¡Œçš„èŠ‚ç‚¹ã€‚

---

## 7. ä½¿ç”¨ Ignition éƒ¨ç½²åˆçº¦ï¼ˆä¿®æ­£ç‰ˆï¼‰

### ğŸš€ æ‰§è¡Œ Ignition éƒ¨ç½²å‘½ä»¤ï¼ˆå¸¦ deploymentIdï¼‰

```bash
npx hardhat ignition deploy ./ignition/modules/Counter.ts --network localhost deployment-v1
```

ğŸ“Œ ç¤ºä¾‹è¾“å‡ºï¼š
```
Hardhat Ignition ğŸš€

Deploying [ CounterModule ]

Batch #1
  Executed CounterModule#Counter

Batch #2
  Executed CounterModule#Counter.incBy

[ CounterModule ] successfully deployed ğŸš€

Deployed Addresses

CounterModule#Counter - 0x5FbDB2315678afecb367f032d93F642f64180aa3
```

> âœ… éƒ¨ç½²æˆåŠŸåï¼Œåˆçº¦åœ°å€å°†è¢«è®°å½•ï¼Œå¯ç”¨äºåç»­äº¤äº’ã€‚

---

### âœ… å…³äº `deploymentId` å‚æ•°çš„æ­£ç¡®ä½¿ç”¨è¯´æ˜

`deploymentId` æ˜¯ä¸€ä¸ª**å¿…å¡«å‚æ•°**ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€æ¬¡éƒ¨ç½²ä¼šè¯ã€‚å®ƒå¿…é¡»åœ¨å‘½ä»¤æœ«å°¾æä¾›ï¼Œä¸”ä¸èƒ½çœç•¥ã€‚

#### âœ… æ­£ç¡®ç”¨æ³•æ ¼å¼

```bash
npx hardhat ignition deploy <module-path> --network <network-name> --deployment-id <deploymentId>
```

#### âœ… æ­£ç¡®ç¤ºä¾‹

```bash
# éƒ¨ç½²åˆ°æœ¬åœ°èŠ‚ç‚¹
npx hardhat ignition deploy ./ignition/modules/Counter.ts \
  --network localhost \
  --deployment-id my-deployment-id

# éƒ¨ç½²åˆ° Sepolia æµ‹è¯•ç½‘ï¼ˆéœ€åœ¨hardhat.config.tsé…ç½®ï¼‰
npx hardhat ignition deploy ./ignition/modules/Counter.ts \
  --network sepolia \
  --deployment-id sepolia-v1

âœ… Sepolia æ˜¯å½“å‰ä»¥å¤ªåŠå®˜æ–¹æ¨èçš„ PoW æµ‹è¯•ç½‘ï¼ŒchainId: 11155111
ğŸ”§ é…ç½® hardhat.config.ts ä¸­çš„ Sepolia ç½‘ç»œï¼š
sepolia: {
  url: "https://eth-sepolia.g.alchemy.com/v2/YOUR_ALCHEMY_KEY", // æˆ– Infura
  accounts: [process.env.PRIVATE_KEY],
  chainId: 11155111,
}

# éƒ¨ç½²åˆ°ä¸»ç½‘
npx hardhat ignition deploy ./ignition/modules/Counter.ts --network mainnet prod-2025

âš ï¸ ä¸»ç½‘éƒ¨ç½²éœ€æåº¦è°¨æ…ï¼ç¡®ä¿ï¼šï¼ˆæµ‹è¯•åŠå­¦ä¹ ä¸€å®šä¸è¦ç”¨ä¸»ç½‘éƒ¨ç½²ï¼‰

åˆçº¦å·²é€šè¿‡å®¡è®¡
å·²æµ‹è¯•å……åˆ†
ä½¿ç”¨å¤šç­¾é’±åŒ…æˆ–ä»£ç†æ¨¡å¼ï¼ˆå¦‚ OpenZeppelin Proxyï¼‰
PRIVATE_KEY å®‰å…¨éš”ç¦»ï¼ˆå»ºè®®ç”¨ dotenv + é™åˆ¶è®¿é—®ï¼‰
```

> âœ… **`deploymentId` å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²**ï¼Œå¦‚ `v1`, `testnet-phase1`, `prod-2025` ç­‰ï¼Œç”¨äºåŒºåˆ†ä¸åŒç¯å¢ƒæˆ–ç‰ˆæœ¬çš„éƒ¨ç½²ã€‚

---

### ğŸ” é«˜çº§ç”¨æ³•

- **å¼ºåˆ¶é‡ç½®å¹¶é‡æ–°éƒ¨ç½²**ï¼ˆæ¸…é™¤æ—§éƒ¨ç½²çŠ¶æ€ï¼‰ï¼š

```bash
npx hardhat ignition deploy --network localhost --reset deployment-v1
```

- **æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€**ï¼š

```bash
npx hardhat ignition status deployment-v1
```

- **åˆ—å‡ºæ‰€æœ‰å·²ä¿å­˜çš„éƒ¨ç½²**ï¼šä½¿ç”¨ find + xargsï¼ˆwsl-Ubuntu/Linux/macOS é«˜æ•ˆæ–¹å¼ï¼‰

```bash
# ä¸æŒ‡å®š --networkï¼Œè®© Ignition è‡ªåŠ¨åˆ¤æ–­
ls ignition/deployments | xargs -I {} sh -c 'echo "=== Status: {} ==="; npx hardhat ignition status {}; echo'
```

- **æŸ¥çœ‹å¸®åŠ©**ï¼š

```bash
npx hardhat ignition deploy --help
```

---

## 8. è¿è¡Œæµ‹è¯•ï¼šTypeScript + Solidity

### ğŸ§ª è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆTS + Solidityï¼‰

```bash
npx hardhat test
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
Running Solidity tests
  contracts/Counter.t.sol:CounterTest
    âœ” test_InitialValue()
    âœ” test_IncByZero()
    âœ” testFuzz_Inc(uint8) (runs: 256)

  3 passing

Running node:test tests
  Counter
    âœ” Should emit the Increment event when calling inc() (644ms)
    âœ” The sum of events should match current value (1027ms)

  2 passing (79s)
```

âœ… æµ‹è¯•é€šè¿‡è¡¨æ˜ï¼š
- åˆçº¦é€»è¾‘æ­£ç¡®
- å¯é€šè¿‡ Viem æˆåŠŸäº¤äº’
- äº‹ä»¶è§¦å‘ç¬¦åˆé¢„æœŸ

---

### ğŸ§ª è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶

```bash
npx hardhat test test/Counter.ts
```

### ğŸ” è¿‡æ»¤æµ‹è¯•ç”¨ä¾‹

```bash
npx hardhat test --grep "Increment"
```

ä»…è¿è¡ŒåŒ…å« "Increment" çš„æµ‹è¯•ç”¨ä¾‹ã€‚

---

## 9. ä½¿ç”¨ Viem è¿›è¡Œé“¾ä¸ŠçŠ¶æ€æŸ¥è¯¢ä¸äº¤äº’

### âœ… å‰ææ¡ä»¶

è¦åœ¨ `npx hardhat console` ä¸­ä½¿ç”¨ `viem`ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

1.  **å®‰è£…äº† `@nomicfoundation/hardhat-viem` æ’ä»¶**ï¼š
    ```bash
    npm install --save-dev @nomicfoundation/hardhat-viem
    ```

2.  **åœ¨ `hardhat.config.ts` ä¸­å¯ç”¨äº†æ’ä»¶**ï¼š
    ```ts
    import { HardhatUserConfig } from "hardhat/config";
    import hardhatViem from "@nomicfoundation/hardhat-viem"; // å¯¼å…¥æ’ä»¶

    const config: HardhatUserConfig = {
      plugins: [
        hardhatViem, // æ³¨å†Œæ’ä»¶
      ],
      solidity: "0.8.28",
      networks: {
        localhost: {
          url: "http://localhost:8545",
        },
      },
    };

    export default config;
    ```

3.  **å·²ç¼–è¯‘åˆçº¦**ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰ï¼š
    ```bash
    npx hardhat compile
    ```

---

### ğŸ”¹ æ­¥éª¤ 1ï¼šå¯åŠ¨æ§åˆ¶å°
```bash
npx hardhat console --network localhost
```

### ğŸ”¹ æ­¥éª¤ 2ï¼šè·å– `viem` å®ä¾‹å¹¶æŸ¥è¯¢ä½™é¢

åœ¨æ§åˆ¶å°ä¸­ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```ts
// 1. è·å– viem æ‰©å±•åŠŸèƒ½
const { viem } = await hre.network.connect();

// 2. è·å– Public Client
const publicClient = await viem.getPublicClient();

// 3. æŸ¥è¯¢æŒ‡å®šåœ°å€çš„ä½™é¢ï¼ˆä»¥ wei ä¸ºå•ä½ï¼‰
const balance = await publicClient.getBalance({
  address: "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266",
});

// 4. è¾“å‡ºä½™é¢
console.log("Balance:", balance); // ä¾‹å¦‚: 10000000000000000000000n

// 5. ï¼ˆå¯é€‰ï¼‰è½¬æ¢ä¸º ETH
console.log("Balance in ETH:", Number(balance) / 1e18); // ä¾‹å¦‚: 10000
```

#### ğŸ”¹ ç¤ºä¾‹è¾“å‡º
```
> const { viem } = await hre.network.connect();
undefined
> const publicClient = await viem.getPublicClient();
undefined
> const balance = await publicClient.getBalance({ address: "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266" });
undefined
> console.log("Balance:", balance);
Balance: 10000000000000000000000n
```

---

### ğŸ§© å…¶ä»–æœ‰ç”¨çš„ `viem` æŸ¥è¯¢å‘½ä»¤

#### æŸ¥è¯¢æœ€æ–°åŒºå—å·
```ts
const blockNumber = await publicClient.getBlockNumber();
console.log("Latest block number:", blockNumber);
```

#### æŸ¥è¯¢åŒºå—ä¿¡æ¯
```ts
const block = await publicClient.getBlock();
console.log("Block:", block);
```

#### ä½¿ç”¨ `getWalletClients` å‘é€äº¤æ˜“ï¼ˆç¤ºä¾‹ï¼‰
```ts
const [wallet1] = await viem.getWalletClients();
const txHash = await wallet1.sendTransaction({
  to: "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266",
  value: 1000000000000000000n, // 1 ETH
});
console.log("Transaction hash:", txHash);
```

---

### âš ï¸ å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| `hre.viem is undefined` | æœªå®‰è£…æˆ–æœªå¯ç”¨ `@nomicfoundation/hardhat-viem` æ’ä»¶ | æ£€æŸ¥ `package.json` å’Œ `hardhat.config.ts` |
| `TypeError: Class extends undefined` | `hardhat@3.x` ä¸æŸäº›æ’ä»¶ç‰ˆæœ¬å†²çªï¼ˆå¦‚ `hardhat-ethers`ï¼‰ | é™çº§åˆ° `hardhat@2.26.0` æˆ–ä½¿ç”¨çº¯ `viem` æ–¹æ¡ˆ |
| `address is required` | æŸ¥è¯¢ä½™é¢æ—¶æœªæä¾› `address` å­—æ®µ | ç¡®ä¿ `getBalance()` è°ƒç”¨ä¸­åŒ…å« `{ address: "..." }` |

---

## 10. éƒ¨ç½²åéªŒè¯ä¸å¸¸ç”¨æ“ä½œ

### âœ… éªŒè¯éƒ¨ç½²çŠ¶æ€

```bash
npx hardhat ignition status deployment-v1
```

æŸ¥çœ‹æŒ‡å®š `deploymentId` çš„éƒ¨ç½²ä»»åŠ¡çŠ¶æ€ï¼Œæ”¯æŒä¸­æ–­åæ¢å¤ã€‚

---

### ğŸ› ï¸ å…¶ä»–å®ç”¨å‘½ä»¤å»ºè®®

| åœºæ™¯ | å‘½ä»¤ |
|------|------|
| æ¸…ç†ç¼“å­˜å’Œæ„å»ºäº§ç‰© | `npx hardhat clean` |
| æ‰“å¼€äº¤äº’å¼æ§åˆ¶å° | `npx hardhat console --network localhost` |
| æ‰å¹³åŒ–åˆçº¦ç”¨äºéªŒè¯ | `npx hardhat flatten contracts/Counter.sol > flattened.sol` |
| è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶ | `npx hardhat test test/Counter.ts` |
| åˆ—å‡ºé¢„è®¾è´¦æˆ· | `npx hardhat accounts` |

---

### ğŸ”„ è‡ªå®šä¹‰è„šæœ¬ï¼ˆæ¨èæ·»åŠ åˆ° `package.json`ï¼‰

```json
{
  "scripts": {
    "build": "npx hardhat compile",
    "test": "npx hardhat test",
    "start": "npx hardhat node",
    "deploy": "npx hardhat ignition deploy ./ignition/modules/Counter.ts --network localhost deployment-v1",
    "console": "npx hardhat console --network localhost",
    "clean": "npx hardhat clean"
  }
}
```

ç„¶åå¯ç®€å†™ä¸ºï¼š

```bash
npm run build
npm run test
npm run start
npm run deploy
```

---

## 11. é™„å½•ï¼šHardhat å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨

ä»¥ä¸‹ä¸º **Hardhat v3** å¸¸ç”¨ CLI å‘½ä»¤æ±‡æ€»ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»åˆ—å‡ºã€‚

### ğŸ§° æ ¸å¿ƒä»»åŠ¡

| å‘½ä»¤ | æè¿° |
|------|------|
| `npx hardhat` | æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤ |
| `npx hardhat --version` | æŸ¥çœ‹å½“å‰ Hardhat ç‰ˆæœ¬ |
| `npx hardhat compile` | ç¼–è¯‘æ‰€æœ‰ Solidity åˆçº¦ |
| `npx hardhat clean` | åˆ é™¤ `artifacts/` å’Œ `cache/` ç›®å½• |
| `npx hardhat run <script>` | æ‰§è¡ŒæŒ‡å®šè„šæœ¬ï¼ˆå¦‚éƒ¨ç½²è„šæœ¬ï¼‰ |
| `npx hardhat console` | å¯åŠ¨äº¤äº’å¼ JavaScript/TypeScript æ§åˆ¶å° |

---

### ğŸ–¥ï¸ æœ¬åœ°ç½‘ç»œä¸èŠ‚ç‚¹

| å‘½ä»¤ | æè¿° |
|------|------|
| `npx hardhat node` | å¯åŠ¨æœ¬åœ° JSON-RPC èŠ‚ç‚¹ï¼ˆç›‘å¬ `localhost:8545`ï¼‰ |
| `npx hardhat run <script> --network localhost` | åœ¨æœ¬åœ°èŠ‚ç‚¹ä¸Šè¿è¡Œè„šæœ¬ |
| `npx hardhat run <script> --network hardhat` | ä½¿ç”¨å†…å­˜é“¾è¿è¡Œè„šæœ¬ï¼ˆé»˜è®¤ï¼‰ |

---

### ğŸ§ª æµ‹è¯•ç›¸å…³

| å‘½ä»¤ | æè¿° |
|------|------|
| `npx hardhat test` | è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆTS å’Œ `.t.sol`ï¼‰ |
| `npx hardhat test <file>` | è¿è¡ŒæŒ‡å®šæµ‹è¯•æ–‡ä»¶ |
| `npx hardhat test --grep "Increment"` | ä»…è¿è¡ŒåŒ…å«å…³é”®å­—çš„æµ‹è¯•ç”¨ä¾‹ |
| `npx hardhat coverage` *(éœ€æ’ä»¶)* | ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š |

---

### ğŸš€ éƒ¨ç½²ä¸ Ignition

| å‘½ä»¤ | æè¿° |
|------|------|
| `npx hardhat ignition deploy <module> <deploymentId>` | ä½¿ç”¨ Ignition éƒ¨ç½²æŒ‡å®šæ¨¡å—ï¼ˆå¿…é¡»æä¾› deploymentIdï¼‰ |
| `npx hardhat ignition status <deploymentId>` | æŸ¥çœ‹æŒ‡å®šéƒ¨ç½²çš„çŠ¶æ€ï¼ˆæ”¯æŒä¸­æ–­æ¢å¤ï¼‰ |
| `npx hardhat ignition list` | åˆ—å‡ºæ‰€æœ‰å·²å®šä¹‰çš„éƒ¨ç½²æ¨¡å— |

---

### ğŸ“¦ å·¥å…·ä¸è¾…åŠ©

| å‘½ä»¤ | æè¿° |
|------|------|
| `npx hardhat flatten <file>` | å°†åˆçº¦åŠå…¶ä¾èµ–åˆå¹¶ä¸ºå•ä¸ªæ–‡ä»¶ï¼ˆç”¨äºéªŒè¯ï¼‰ |
| `npx hardhat verify <address>` | éªŒè¯åˆçº¦æºç ï¼ˆéœ€è¿æ¥ etherscan-like æœåŠ¡ï¼‰ |
| `npx hardhat accounts` | åˆ—å‡º Hardhat Network é¢„è®¾è´¦æˆ· |
| `npx hardhat help <task>` | æŸ¥çœ‹æŸä¸ªå‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£ |

---

## 12. æ€»ç»“ä¸æœ€ä½³å®è·µå»ºè®®

æœ¬æ–‡æ¡£å…¨é¢æ¢³ç†äº†åŸºäº **Node.js v22 + npm 10 + Hardhat v3** çš„ç°ä»£ä»¥å¤ªåŠå¼€å‘ç¯å¢ƒæ­å»ºä¸å…¨æµç¨‹æ“ä½œï¼Œæ¶µç›–ï¼š

- âœ… ç²¾ç¡®çš„ç»„ä»¶ç‰ˆæœ¬çŸ©é˜µä¸å…¼å®¹æ€§åˆ†æ  
- âœ… è¯¦ç»†çš„é¡¹ç›®åˆå§‹åŒ–äº¤äº’æ­¥éª¤  
- âœ… ä¾èµ–å®‰è£…åŸç†ä¸æ ¸å¿ƒåŒ…è¯´æ˜  
- âœ… é¡¹ç›®ç»“æ„å›¾è§£ä¸å„æ–‡ä»¶èŒè´£  
- âœ… ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€éªŒè¯å…¨æµç¨‹æ¼”ç¤º  
- âœ… å®Œæ•´çš„ Hardhat å‘½ä»¤é€ŸæŸ¥æ‰‹å†Œ  

> ğŸš€ **å¼ºçƒˆå»ºè®®æ–°é¡¹ç›®é‡‡ç”¨ Hardhat v3 + Viem + Node Test Runner æŠ€æœ¯æ ˆ**ï¼Œäº«å—æ›´ç°ä»£ã€é«˜æ•ˆã€å¯é çš„å¼€å‘ä½“éªŒã€‚

ğŸ“Œ **æœ€ä½³å®è·µå»ºè®®**ï¼š
1. ä½¿ç”¨ `ignition` è¿›è¡Œå£°æ˜å¼éƒ¨ç½²ï¼Œé¿å…è„šæœ¬æ··ä¹±ã€‚
2. ä¼˜å…ˆä½¿ç”¨ `viem` æ›¿ä»£ `ethers.js`ï¼Œæå‡æ€§èƒ½ä¸ç±»å‹å®‰å…¨ã€‚
3. åˆ©ç”¨ `.t.sol` ç¼–å†™ Solidity å•å…ƒæµ‹è¯•ï¼Œæé«˜è¦†ç›–ç‡ã€‚
4. å°†å¸¸ç”¨å‘½ä»¤å†™å…¥ `package.json` çš„ `scripts` ä¸­ï¼Œç®€åŒ–æ“ä½œã€‚
5. å®šæœŸè¿è¡Œ `npx hardhat clean` æ¸…ç†ç¼“å­˜ï¼Œé¿å…æ„å»ºé—®é¢˜ã€‚

ğŸ“Œ æ–‡æ¡£å†…å®¹å·²ä¸å®é™…æ“ä½œå®Œå…¨å¯¹é½ï¼Œé€‚ç”¨äºå­¦ä¹ ã€æ•™å­¦ä¸ç”Ÿäº§ç¯å¢ƒåˆå§‹åŒ–å‚è€ƒã€‚
