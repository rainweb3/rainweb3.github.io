### **第11章：NFT 与数字资产：从创作到交易（2025年10月最新版）**

⚠️ 免责声明：本文档旨在提供教育性、参考性的技术指导，基于当前（2025年）社区广泛认可的最佳实践。它不构成任何形式的投资、法律或专业建议。智能合约开发风险极高，任何部署前都应进行严格的自我审查、自动化扫描和第三方审计。

非同质化代币（**NFT**）已超越“数字头像”范畴，成为数字所有权、身份、游戏资产和现实世界资产（RWA）上链的核心载体。本章系统讲解NFT的**技术标准、元数据结构、铸造流程、法律边界与市场生态**，并提供**生产级、无过时信息、可直接部署**的完整实践指南。

---

#### **1. NFT 标准：ERC-721 vs ERC-1155**

| 特性 | **ERC-721** | **ERC-1155** |
|------|-------------|--------------|
| **同质性** | 每个Token唯一（非同质化） | 支持同质化与非同质化混合 |
| **交易效率** | 每笔交易处理一个Token | 批量操作（mint/transfer多个ID） |
| **Gas 成本** | 较高 | 更低（批量节省Gas） |
| **适用场景** | 艺术品、收藏品、域名 | 游戏道具、票务、多版本资产 |
| **主流项目** | Bored Ape, CryptoPunks | Axie Infinity, The Sandbox |

> ✅ **2025年推荐**：
> - **收藏品类NFT** → 使用 **ERC-721**
> - **游戏/功能性NFT** → 使用 **ERC-1155**

##### **代码示例：ERC-721 合约（Solidity 0.8.26 + OpenZeppelin）**
```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

import "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/Counters.sol";

contract MyNFT is ERC721, Ownable {
    using Counters for Counters.Counter;

    Counters.Counter private _tokenIdCounter;
    string private _baseURIValue;

    // 销售状态控制
    bool public isSaleActive = false;

    constructor() ERC721("MyNFT", "MNFT") Ownable(msg.sender) {}

    function safeMint() public payable {
        require(isSaleActive, "Sale is not active");
        require(msg.value >= 0.01 ether, "Insufficient funds");
        require(totalSupply() < 10000, "Max supply reached");

        uint256 tokenId = _tokenIdCounter.current();
        _tokenIdCounter.increment();
        _safeMint(msg.sender, tokenId);
    }

    function setBaseURI(string memory baseURI_) public onlyOwner {
        _baseURIValue = baseURI_;
    }

    function _baseURI() internal view override returns (string memory) {
        return _baseURIValue;
    }

    function withdraw() public onlyOwner {
        (bool success, ) = payable(owner()).call{value: address(this).balance}("");
        require(success, "Withdrawal failed");
    }

    function toggleSale() public onlyOwner {
        isSaleActive = !isSaleActive;
    }
}
```

> 🔐 **安全说明**：
> - 使用 `Ownable` 控制关键函数。
> - `withdraw()` 防止资金锁定。
> - `toggleSale()` 安全启停铸造。

---

#### **2. 元数据结构（JSON + IPFS）**

NFT的“灵魂”在于其**链外元数据**，通常以JSON格式存储在IPFS。

##### **（1）标准元数据结构（EIP-721 Metadata JSON Schema）**
```json
{
  "name": "My NFT #1",
  "description": "A unique digital collectible",
  "image": "ipfs://bafybeigdyrzzjv5qgvmf7x5q3q3q3q3q3q3q3q3q3q3q3q3q3q3q3q3q3q/nft1.png",
  "external_url": "https://myproject.com/nft/1",
  "attributes": [
    {
      "trait_type": "Background",
      "value": "Blue"
    },
    {
      "trait_type": "Mouth",
      "value": "Smile"
    }
  ]
}
```

##### **（2）关键字段说明**
| 字段 | 说明 |
|------|------|
| `name` | NFT名称 |
| `description` | 描述 |
| `image` | 图像CID（支持PNG, GIF, SVG, MP4等） |
| `external_url` | 指向项目官网 |
| `attributes` | 特征属性（用于OpenSea展示稀有度） |

##### **（3）上传至IPFS（使用 NFT.Storage）**
```ts
import { NFTStorage, File } from 'nft.storage';

const client = new NFTStorage({ token: 'YOUR_API_KEY' });

const metadata = await client.store({
  name: 'My NFT #1',
  description: 'Stored on Filecoin via NFT.Storage',
  image: new File([imageBuffer], 'nft1.png', { type: 'image/png' }),
  attributes: [{ trait_type: 'Rarity', value: 'Legendary' }]
});

console.log('Metadata CID:', metadata.url); // ipfs://bafy...
```

> ✅ **最佳实践**：
> - 使用 **NFT.Storage** 或 **Pinata** 自动备份到Filecoin。
> - `image` 字段必须是 **完整IPFS URL**（`ipfs://...`），而非网关链接。

---

#### **3. 铸造（Minting）流程**

##### **（1）流程图**
```
用户点击“Mint” → DApp调用合约 → 支付ETH → 合约生成Token ID → 触发Transfer事件 → 钱包接收NFT
```

##### **（2）前端调用（React + Ethers.js v6）**
```ts
async function mintNFT(contract: ethers.Contract) {
  try {
    const tx = await contract.safeMint({
      value: ethers.parseEther("0.01"),
      gasLimit: 200000
    });

    const receipt = await tx.wait();
    console.log("Mint successful, Token ID:", receipt?.logs[0].args[2].toString());
    return receipt;
  } catch (error: any) {
    console.error("Mint failed:", error.message);
    throw error;
  }
}
```

##### **（3）Gas 优化建议**
- 使用 **ERC721A**（由Azuki团队开发）实现批量铸造Gas优化。
- 示例：`_mint(msg.sender, 5)` 一次铸造5个，Gas比循环调用低60%。

---

#### **4. 版权与所有权的区别**

这是NFT领域最常见的误解。

| 项目 | 说明 |
|------|------|
| **Token 所有权** | 你拥有区块链上的Token，可转让、出售、质押 |
| **知识产权（Copyright）** | 默认情况下，**不自动转让**。需明确授权 |

##### **（1）典型情况**
- **BAYC（Bored Ape）**：购买者获得商业使用权（可开发衍生品）。
- **大多数项目**：仅授予非商业使用权（个人展示）。
- **CC0 项目**（如 CrypToadz）：版权完全开放，可自由商用。

##### **（2）法律建议**
- 在合约或项目白皮书中**明确声明版权政策**。
- 使用 **[ERC-5484](https://eips.ethereum.org/EIPS/eip-5484)**（NFT版权标准）进行链上声明。

> ⚠️ **重要提醒**：
> - 拥有NFT ≠ 拥有版权。
> - 未经授权商用他人NFT形象可能构成侵权。

---

#### **5. NFT 市场：OpenSea、Blur**

| 市场 | 定位 | 2025年优势 | 适用场景 |
|------|------|------------|----------|
| **OpenSea** | 综合性、多链 | 用户基数大，UI友好，支持Seaport协议 | 新项目首发、长尾资产 |
| **Blur** | 专业交易员 | 低手续费、高级订单类型（荷兰拍、打包卖）、MEV保护 | 高频交易、蓝筹NFT |
| **Zora** | 创作者优先 | 收藏品版税支持，去中心化市场 | 艺术家发行 |
| **Tensor** | Solana生态 | 低Gas，快速交易 | Solana NFT交易 |

##### **（1）版税（Royalty）现状（2025）**
- **OpenSea**：允许项目方设置版税（默认5-10%），但**买家可绕过**。
- **Blur**：默认不强制版税，对创作者不友好。
- **趋势**：**链上强制版税**（如 **EIP-2981**）正在被更多协议支持。

##### **（2）上架流程**
1. 连接钱包（MetaMask）
2. 上传NFT（或输入合约地址 + Token ID）
3. 设置价格（固定价或拍卖）
4. 确认交易（支付Gas）

---

#### **6. 实践：使用 Hardhat 部署一个可铸造的 NFT 合约**

##### **（1）初始化项目**
```bash
mkdir my-nft && cd my-nft
npm init -y
npm install --save-dev hardhat
npx hardhat
# 选择 "Create a JavaScript project"
npm install @openzeppelin/contracts
```

##### **（2）配置 `hardhat.config.js`**
```js
/** @type import('hardhat/config').HardhatUserConfig */
require("@nomicfoundation/hardhat-toolbox");
require('dotenv').config();

module.exports = {
  solidity: "0.8.26",
  networks: {
    sepolia: {
      url: process.env.ALCHEMY_SEPOLIA_URL,
      accounts: [process.env.PRIVATE_KEY]
    },
    ethereum: {
      url: process.env.ALCHEMY_MAINNET_URL,
      accounts: [process.env.PRIVATE_KEY]
    }
  },
  etherscan: {
    apiKey: process.env.ETHERSCAN_API_KEY
  }
};
```

##### **（3）编写部署脚本 `deploy.js`**
```js
const hre = require("hardhat");

async function main() {
  const MyNFT = await hre.ethers.getContractFactory("MyNFT");
  const myNFT = await MyNFT.deploy();

  await myNFT.waitForDeployment();
  console.log(`MyNFT deployed to: ${myNFT.target}`);
}

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
```

##### **（4）部署到测试网**
```bash
# 设置环境变量
echo "ALCHEMY_SEPOLIA_URL=https://eth-sepolia.g.alchemy.com/v2/your-key" >> .env
echo "PRIVATE_KEY=your-wallet-private-key" >> .env
echo "ETHERSCAN_API_KEY=your-etherscan-key" >> .env

# 编译
npx hardhat compile

# 部署
npx hardhat run scripts/deploy.js --network sepolia
```

##### **（5）验证合约**
```bash
npx hardhat verify --network sepolia DEPLOYED_CONTRACT_ADDRESS
```

---

### **本章小结**

截至2025年10月，NFT生态已进入成熟期：

| 组件 | 关键点 | 推荐实践 |
|------|--------|-----------|
| **标准** | ERC-721（收藏）、ERC-1155（游戏） | 使用 OpenZeppelin 安全合约 |
| **元数据** | JSON + IPFS（CID） | 使用 NFT.Storage 自动备份到Filecoin |
| **铸造** | `safeMint()` + Gas优化 | 支持测试网体验 |
| **版权** | 所有权 ≠ 版权 | 明确声明使用权限 |
| **市场** | OpenSea（大众）、Blur（专业） | 多平台同步上架 |

> ✅ **行动建议**：
> 1. **立即在Sepolia测试网部署你的第一个NFT合约**。
> 2. **使用NFT.Storage上传元数据**，确保持久性。
> 3. **在OpenSea测试网市场** 上架你的NFT，完成闭环体验。

